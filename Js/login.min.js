$(document).ready(function () {
  $("#form-dang-nhap").tabs(); // init tab

  $(".iconic-input").on("click", ".icon-wrap", function (e) {
    const targetInput = $(e.delegateTarget).find("input");
    if (targetInput.attr("type") == "password")
      targetInput.attr("type", "text");
    else targetInput.attr("type", "password");
    $(this).toggleClass("active");
  }); // ẩn hiện password

  const singupValidator =
    typeof $.fn.validate == "function"
      ? $("#form-dang-ky").validate({
          errorClass: "input-helper c-main mt-2",
          rules: {
            username: {
              required: true,
              minlength: 10,
              maxlength: 30,
            },
            phone: {
              required: true,
              phone: true,
            },
            email: {
              email: true,
            },
            password: {
              required: true,
              minlength: 10,
              maxlength: 50,
            },
          },
          messages: {
            username: {
              required: "Tài khoản không để trống",
              minlength: "Tài khoản tối thiểu 10 ký tự",
              maxlength: "Tài khoản tối đa 30 ký tự",
            },
            email: {
              email: "Email không hợp lệ",
            },
            phone: {
              required: "Sđt không để trống",
              pattern: "Sđt không hợp lệ",
            },
            password: {
              required: "Mật khẩu không để trống",
              minlength: "Mật khẩu tối thiểu 10 ký tự",
              maxlength: "Mật khẩu tối đa 30 ký tự",
            },
          },
          highlight: function (element, errorClass) {
            $(element).removeClass(errorClass);
          },
        })
      : null;

  $("#quen-mat-khau").validate({
    errorClass: "input-helper c-main mt-2",
    rules: {
      email: {
        email: "Email không hợp lệ",
      },
    },
    messages: {
      email: {
        email: "Email không hợp lệ",
      },
    },
    highlight: function (element, errorClass) {
      $(element).removeClass(errorClass);
    },
  });

  $("input[name=password]").on("keyup", function (e) {
    if ($(this).val() && $(this).val().length >= 10) {
      $("#mat-khau .password-strength").css("display", "flex");
      var passwordStrength = calculatePasswordStrength($(this).val());
      $("#mat-khau .password-strength > span").removeClass("active");
      console.log("password strength: ", passwordStrength);
      if (passwordStrength == "weak") {
        $("#mat-khau .weak").addClass("active");
      }
      if (passwordStrength == "medium") {
        $("#mat-khau .medium").addClass("active");
      }
      if (passwordStrength == "strong") {
        $("#mat-khau .strong").addClass("active");
      }
    } else {
      $(".password-strength").css("display", "none");
    }
  });

  function calculatePasswordStrength(password) {
    let strength = "weak";
    if (
      (password && password.length >= 10 && password.match(/[a-z]/)) ||
      password.match(/\d+/)
    ) {
      strength = "weak";
    }
    if (
      password &&
      password.length >= 15 &&
      password.match(/[a-z|A-Z]/) &&
      password.match(/\d+/)
    ) {
      strength = "medium";
    }
    if (
      password &&
      password.length >= 15 &&
      password.match(/[a-z|A-Z]/) &&
      password.match(/\d+/) &&
      password.match(/.[!,@,#,$,%,^,&,*,?,_,~,-,(,)]/)
    ) {
      strength = "strong";
    }
    return strength;
  }
});
