$(document).ready(function () {
  // variables
  var mainColor = "#da5427#";
  var DATETIME_FORMAT = "DD/MMYYYY hh:mm:ss";
  var switchBaseConfig = {
    on_txt: "Có",
    off_txt: "Không",
    on_color: mainColor,
  };
  const provinceList = [
    {
      id: 1,
      text: "Hà Nội",
    },
    {
      id: 2,
      text: "Hải Phòng",
    },
  ];

  const brandList = [
    {
      id: 1,
      text: "Toyota",
    },
    {
      id: 2,
      text: "Mercedes",
    },
    {
      id: 3,
      text: "RollRoyce",
    },
  ];

  const lineList = [
    {
      id: 1,
      text: "Camry",
    },
    {
      id: 2,
      text: "Maybach",
    },
    {
      id: 3,
      text: "Phantom",
    },
  ];

  const exteriorList = [
    {
      id: 1,
      text: "đen",
      value: "#000000",
    },
    {
      id: 2,
      text: "cam",
      value: "#d95327",
    },
  ];

  const interiorColor = [
    {
      id: 1,
      text: "đen",
      value: "#000000",
    },
    {
      id: 2,
      text: "cam",
      value: "#d95327",
    },
  ];

  const seatList = [
    {
      id: 1,
      text: "3",
    },
    {
      id: 2,
      text: "4",
    },
  ];

  const doorList = [
    {
      id: 1,
      text: "2",
    },
    {
      id: 2,
      text: "4",
    },
  ];

  const fuelList = [
    {
      id: 1,
      text: "xăng",
    },
    {
      id: 2,
      text: "dầu",
    },
  ];

  // form validation
  const validator = $("#form-dang-tin").validate({
    errorClass: "error-label c-main mt-2",
    rules: {
      image: {
        required: true,
        number: true,
        min: 1,
      },
      title: {
        required: true,
      },
      "description-value": {
        required: true,
        minlength: 100,
      },
      price: {
        required: true,
      },
      location: {
        required: true,
      },
    },
    messages: {
      image: {
        required: "Hình ảnh không được để trống",
        min: "Hình ảnh không được để trống",
      },
      title: {
        required: "Tiêu đề không được bỏ trống",
      },
      "description-value": {
        required: "Mô tả không được để trống",
        minlength: "Mô tả ít hơn 100 ký tự",
      },
      price: {
        required: "Giá không được để trống",
      },
      location: {
        required: "Tỉnh thành không được để trống",
      },
    },
    highlight: function (element, errorClass) {
      $(element).removeClass(errorClass);
    },
  });

  $("#form-dang-tin").steps({
    headerTag: "h4",
    bodyTag: "section",
    transitionEffect: "fade",
    titleTemplate: '<div class="title">#title#</div>',
    autoFocus: true,
    enableAllSteps: true,
    transitionEffectSpeed: 300,
  });
  $("#tiep-theo").click(function () {
    $("#form-dang-tin").steps("next");
  });
  $("#quay-lai").click(function () {
    $("#form-dang-tin").steps("previous");
  });

  $("#editor").tinymce({
    height: 300,
    width: "100%",
    menubar: false,
    plugins: [
      "advlist autolink lists link image charmap print preview anchor",
      "searchreplace visualblocks code fullscreen",
      "insertdatetime media table paste code help wordcount",
    ],
    toolbar:
      "undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",
    statusbar: false,
    skin: "outside",
    setup: function (editor) {
      editor.on("init", function (e) {
        // editor.setContent(
        //   deserializeContent($("input[name=description]").val()),
        // );
      });
    },
    init_instance_callback: function (editor) {
      //   editor.on("keydown", function (e) {
      //     var value = sanitizeInputContent(editor.getContent());
      //     updatePost("description", value);
      //     descriptionEl.val(value);
      //     validator.element(descriptionEl); // re-validate description manually
      //   });
      //   editor.on("keyup", function (e) {
      //     var value = sanitizeInputContent(editor.getContent());
      //     updatePost("description", value);
      //     descriptionEl.val(value);
      //     validator.element(descriptionEl); // re-validate description manually
      //   });
      //   editor.on("blur", function (e) {
      //     var value = sanitizeInputContent(editor.getContent());
      //     updatePost("description", value);
      //     descriptionEl.val(value);
      //     validator.element(descriptionEl); // re-validate description manually
      //   });
    },
  });

  const switchSelector = $("input[type=checkbox].lcs_check");
  lc_switch(switchSelector, switchBaseConfig); // init switch
  switchSelector.on("lcs-statuschange", function (e) {
    let status = this.checked ? "checked" : "unchecked";
  });

  $("#tinh-thanh").select2({
    data: provinceList,
    placeholder: "Tỉnh/Thành phố bán xe",
    width: "100%",
  });
  $("#hang-xe").select2({
    data: brandList,
    placeholder: "Chọn hãng xe",
    width: "100%",
  });
  $("#dong-xe").select2({
    data: lineList,
    placeholder: "Chọn dòng xe",
    width: "100%",
  });
  $("#nhien-lieu").select2({
    data: fuelList,
    placeholder: "Chọn nhiên liệu",
    width: "100%",
  });
  $("#ngoai-that").select2({
    data: exteriorList,
    placeholder: "Màu ngoại thất",
    templateResult: formatSelect2Option, // format option hiển thị ra
    templateSelection: formatSelect2Option, // format option được chọn
    width: "100%",
  });
  $("#noi-that").select2({
    data: interiorColor,
    placeholder: "Màu nội thất",
    templateResult: formatSelect2Option, // format option hiển thị ra
    templateSelection: formatSelect2Option, // format option được chọn
    width: "100%",
  });
  $("#so-ghe").select2({
    data: seatList,
    placeholder: "Chọn số ghế",
    width: "100%",
  });
  $("#so-cua").select2({
    data: doorList,
    placeholder: "Chọn số cửa",
    width: "100%",
  });

  $('#form-dang-tin [data-toggle="datepicker"].startDate').datepicker({
    autoPick: true,
    autoHide: true,
    format: "dd-mm-yyyy",
    // date: startDate,
    // filter: filterStartDate
  });
  $('#form-dang-tin [data-toggle="datepicker"].endDate').datepicker({
    autoPick: true,
    autoHide: true,
    format: "dd-mm-yyyy",
    // date: endDate,
    // filter: filterEndDate
  });

  // click chọn tin
  $("#form-dang-tin").on("click", ".sales-type-select", function (e) {
    const element = $(e.currentTarget);
    $(".sales-type-item").removeClass("active");
    element.closest(".sales-type-item").addClass("active");
  });

  function formatSelect2Option(option) {
    return $(
      "<div class='d-flex select2-result clearfix'>" +
        "<div class='d-flex select2-result__color clearfix mr-1' style='background:" +
        option.value +
        "'>" +
        "</div>" +
        "<div class='d-flex select2__name clearfix'>" +
        option.text +
        "</div>" +
        "</div>",
    );
  }
});
